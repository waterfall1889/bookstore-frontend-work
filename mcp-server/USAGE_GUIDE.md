# BookStore MCP 服务器使用指南

## 快速开始

### 1. 安装依赖

**Windows:**
```bash
cd mcp-server
install.bat
```

**Linux/Mac:**
```bash
cd mcp-server
chmod +x install.sh
./install.sh
```

或手动安装:
```bash
pip install -r requirements.txt
```

### 2. 测试连接

在配置Cherry Studio之前，先测试数据库连接和MCP库是否正常：

```bash
python test_connection.py
```

如果测试通过，你会看到：
```
✓ 数据库连接测试通过！
✓ MCP库导入成功
✓ 所有测试通过！MCP服务器可以正常使用。
```

### 3. 配置Cherry Studio

参考 `CHERRY_STUDIO_GUIDE.md` 文件进行详细配置。

## 功能说明

### 可用工具

MCP服务器提供以下4个工具供AI助手使用：

#### 1. search_books - 搜索图书
根据书名、作者、ISBN或出版社进行模糊搜索。

**参数:**
- `query` (必需): 搜索关键词
- `limit` (可选): 返回结果数量，默认10

**示例:**
```
用户: 帮我找一本关于Java的书籍
AI: [自动调用search_books工具] 找到了以下Java相关书籍...
```

#### 2. get_book_by_id - 根据ID获取图书
根据图书的唯一ID获取详细信息。

**参数:**
- `item_id` (必需): 图书ID

**示例:**
```
用户: 告诉我ID为B001的图书信息
AI: [自动调用get_book_by_id工具] 图书详细信息: ...
```

#### 3. get_books_by_author - 查找作者的所有图书
根据作者名称查找该作者的所有图书。

**参数:**
- `author` (必需): 作者名称
- `limit` (可选): 返回结果数量，默认20

**示例:**
```
用户: 查找作者"张三"的所有图书
AI: [自动调用get_books_by_author工具] 找到作者'张三'的3本图书...
```

#### 4. get_available_books - 获取有库存的图书
获取所有有库存的图书列表。

**参数:**
- `limit` (可选): 返回结果数量，默认20
- `min_stock` (可选): 最小库存数量，默认1

**示例:**
```
用户: 显示所有有库存的图书
AI: [自动调用get_available_books工具] 找到20本有库存的图书...
```

## 使用对比

### 不使用MCP服务器时

**场景:** AI助手无法访问你的数据库

**对话示例:**
```
用户: 帮我找一本关于Python的书籍

AI: 我可以为您推荐一些Python相关的经典书籍：
1. 《Python编程：从入门到实践》- 适合初学者
2. 《流畅的Python》- 适合有经验的开发者
3. 《Python Cookbook》- 实用技巧集合
...

（AI只能基于训练数据回答，无法获取你系统中的实际图书信息）
```

**特点:**
- ❌ 无法访问实际数据库
- ❌ 无法获取实时库存、价格信息
- ❌ 只能提供通用建议
- ❌ 无法查询特定图书的详细信息

### 使用MCP服务器后

**场景:** AI助手可以直接查询你的MySQL数据库

**对话示例:**
```
用户: 帮我找一本关于Python的书籍

AI: [使用search_books工具查询数据库]

找到了以下Python相关书籍：

书名: Python编程入门
作者: 李四
价格: ¥59.00
库存: 15 本
ISBN: 978-7-123456-78-9
出版社: 科技出版社
图书ID: B005

---

书名: Python高级编程
作者: 王五
价格: ¥89.00
库存: 8 本
ISBN: 978-7-123456-79-6
出版社: 电子工业出版社
图书ID: B012

（AI直接从你的数据库查询并返回实际数据）
```

**特点:**
- ✅ 直接访问MySQL数据库
- ✅ 获取实时库存、价格信息
- ✅ 返回你系统中的实际图书数据
- ✅ 支持多种查询方式（书名、作者、ISBN等）
- ✅ 可以查询特定图书的详细信息

## 截图对比说明

为了展示MCP服务器的效果，建议进行以下操作并截图：

### 步骤1: 不使用MCP服务器

1. 打开Cherry Studio（未配置MCP服务器或已禁用）
2. 在对话框中输入："帮我找一本关于Java的书籍"
3. 截图保存为 `without_mcp.png`
4. 观察AI的回复（应该是基于通用知识的回答）

### 步骤2: 使用MCP服务器

1. 配置MCP服务器并重启Cherry Studio
2. 在对话框中输入相同的问题："帮我找一本关于Java的书籍"
3. 截图保存为 `with_mcp.png`
4. 观察AI的回复（应该显示从数据库查询的实际图书信息）

### 步骤3: 对比分析

**第一张图 (without_mcp.png):**
- AI回答基于通用知识
- 无法提供你系统中的实际图书信息
- 无法显示价格、库存等实时数据

**第二张图 (with_mcp.png):**
- AI回答基于数据库查询
- 显示你系统中的实际图书
- 包含价格、库存、ISBN等详细信息
- 可以看到AI使用了MCP工具（通常在回复中会显示）

### 额外测试场景

你也可以测试以下场景并截图：

1. **查询特定图书ID**
   - 不使用MCP: "告诉我ID为B001的图书信息" → AI无法回答
   - 使用MCP: "告诉我ID为B001的图书信息" → AI返回详细图书信息

2. **查找作者的所有图书**
   - 不使用MCP: "查找作者张三的所有图书" → AI无法回答
   - 使用MCP: "查找作者张三的所有图书" → AI返回该作者的所有图书

3. **查询库存信息**
   - 不使用MCP: "哪些书有库存？" → AI无法回答
   - 使用MCP: "哪些书有库存？" → AI返回有库存的图书列表

## 故障排除

### 问题: MCP服务器无法连接

**检查清单:**
1. ✅ Python版本 >= 3.8
2. ✅ 已安装所有依赖: `pip install -r requirements.txt`
3. ✅ 数据库服务正在运行
4. ✅ 数据库连接配置正确
5. ✅ Cherry Studio配置文件路径正确
6. ✅ Python命令在系统PATH中

### 问题: AI助手无法使用工具

**可能原因:**
1. MCP服务器未正确配置
2. Cherry Studio未识别MCP服务器
3. 数据库连接失败

**解决方法:**
1. 运行 `python test_connection.py` 检查连接
2. 查看Cherry Studio的日志文件
3. 确认配置文件格式正确（JSON格式）

### 问题: 查询结果为空

**可能原因:**
1. 数据库中确实没有匹配的数据
2. 搜索关键词不匹配
3. 图书的 `validness` 字段为0（无效）

**解决方法:**
1. 直接查询数据库确认数据存在
2. 尝试更宽泛的搜索关键词
3. 检查数据库中的 `validness` 字段值

## 技术支持

如有问题，请检查：
- `README.md` - 基本说明
- `CHERRY_STUDIO_GUIDE.md` - Cherry Studio详细配置指南
- `test_connection.py` - 连接测试脚本

